# [Прогнозирование срока доставки](https://platform.stratascratch.com/data-projects/delivery-duration-prediction)

## Задание
Когда потребитель размещает заказ на DoorDash, мы показываем ожидаемое время доставки. Для DoorDash очень важно сделать это правильно, поскольку это оказывает большое влияние на потребительский опыт. В этом упражнении вы построите модель для прогнозирования предполагаемого времени, необходимого для доставки.

Вы должны предсказать общую продолжительность доставки в секундах, то есть время, прошедшее с момента, когда потребитель формирует заказ `created_at` до доставки заказа потребителю `actual_delivery_time`.

<details>
    <summary>Описание данных</summary>

Файл `historical_data.csv` содержит информацию о доставках, выполненных DoorDash в начале 2015 года. Каждая строка в этом файле соответствует одной уникальной доставке. Мы добавили шум в набор данных, чтобы скрыть некоторые бизнес-детали. Обратите внимание, что все денежные значения, приведенные в данных, указаны в центах, а все значения продолжительности времени - в секундах. 

Целевое значение для прогнозирования - это разница в секундах между `created_at` и `actual_delivery_time`.

**Временные признаки**  
* `market_id`: город/регион, в котором работает DoorDash, например, Лос-Анджелес, указанный в данных как id
* `created_at`: Временная метка в UTC, когда потребитель отправил заказ в DoorDash. (Обратите внимание, что эта временная метка указана в UTC, но на случай, если вам это нужно, фактическим часовым поясом региона были США/Тихий океан)
* `actual_delivery_time`: временная метка в UTC, когда заказ был доставлен потребителю

**Характеристики магазина**
* `store_id`: идентификатор ресторана, в который был отправлен заказ
* `store_primary_category`: категория кухни ресторана, например, итальянская, азиатская
* `order_protocol`: магазин может получать заказы от DoorDash многими способами. Это поле представляет собой идентификатор, обозначающий протокол

**Детали заказа**
* `total_items`: общее количество товаров в заказе
* `subtotal`: общая стоимость отправленного заказа (в центах)
* `num_distinct_items`: количество отдельных товаров, включенных в заказ
* `min_item_price`: цена товара с наименьшей стоимостью в заказе (в центах)
* `max_item_price`: цена товара с наибольшей стоимостью в заказе (в центах)

**Признаки площадки**  
Поскольку DoorDash является торговой площадкой, у нас есть информация о состоянии торговой площадки на момент размещения заказа, которая может быть использована для оценки времени доставки. Следующие параметры являются значениями на момент created_at (время отправки заказа):
* `total_onshift_dashers`: Количество доступных dashers, которые находятся в пределах 10 миль от магазина на момент создания заказа 
* `total_busy_dashers`: Подмножество вышеуказанных `total_onshift_dashers`, которые в настоящее время работают над заказом
* `total_outstanding_orders`: Количество заказов в пределах 10 миль от этого заказа, которые в настоящее время обрабатываются.

**Прогнозы других моделей**  
У нас есть прогнозы из других моделей для различных этапов процесса доставки, которые мы можем использовать:
* `estimated_order_place_duration`: Расчетное время, в течение которого ресторан получит заказ от DoorDash (в секундах)
* `estimated_store_to_consumer_driving_duration`: Предполагаемое время в пути между магазином и потребителем (в секундах)

</details>

## Решение
Ход решения и графики можно посмотреть в [ноутбуке](1.0-data-exploration.ipynb), реализацию используемых функций в [скрипте](my_functions.py).

* удалены пропущенные значения в случаях, если отсутствует менее 1% данных;
* оставшиеся пропуски заполнены константами в соответствии со значениями признака;
* удалены выбросы, т.е. данные выходящие за пределы 1.5 IQR;
* из временной метки отправки заказа извлечены месяц, день недели и час;
* произведена визуальная оценка важности и разделяющей способности признаков *(исп. [SHAP](https://shap.readthedocs.io/en/latest/index.html))*;
* отобраны признаки для построения модели *(исп. алгоритм [Boruta](https://www.predictiveresearchsolutions.com/post/data-science-tips-feature-selection-using-boruta-in-python))*;
* инструмент трекинга экспериментов и сравнения моделей - [ClearML](https://clear.ml/);
* сохранена обученная модель CatBoost c *RMSE* на валидационной(отложенной) выборке равной 685 секундам, при среднем сроке доставки заказа 3000 секунд.